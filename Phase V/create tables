

-- 1. CREATE TABLES (in correct order to handle foreign key dependencies)

-- DEPARTMENTS Table (no foreign keys, create first)
CREATE TABLE DEPARTMENTS (
    DeptID NUMBER(10) PRIMARY KEY,
    DeptName VARCHAR2(100) NOT NULL,
    Location VARCHAR2(200),
    HeadOfDept VARCHAR2(100),
    ContactEmail VARCHAR2(100),
    Budget NUMBER(15,2),
    CreatedDate DATE DEFAULT SYSDATE,
    ModifiedDate DATE
);

-- TECHNICIANS Table (references DEPARTMENTS)
CREATE TABLE TECHNICIANS (
    TechID NUMBER(10) PRIMARY KEY,
    FullName VARCHAR2(100) NOT NULL,
    ContactPhone VARCHAR2(20),
    Email VARCHAR2(100),
    Specialty VARCHAR2(100),
    DepartmentID NUMBER(10) REFERENCES DEPARTMENTS(DeptID),
    HireDate DATE,
    Status VARCHAR2(20) DEFAULT 'ACTIVE',
    CertificationLevel VARCHAR2(50),
    CreatedDate DATE DEFAULT SYSDATE
);

-- EQUIPMENT Table (references DEPARTMENTS)
CREATE TABLE EQUIPMENT (
    EquipmentID NUMBER(10) PRIMARY KEY,
    SerialNumber VARCHAR2(50) UNIQUE NOT NULL,
    Name VARCHAR2(200) NOT NULL,
    Category VARCHAR2(50) NOT NULL,
    Manufacturer VARCHAR2(100),
    Model VARCHAR2(50),
    PurchaseDate DATE NOT NULL,
    PurchasePrice NUMBER(15,2),
    WarrantyExpiry DATE,
    Status VARCHAR2(20) CHECK (Status IN ('ACTIVE', 'INACTIVE', 'UNDER_MAINTENANCE', 'DECOMMISSIONED')),
    DepartmentID NUMBER(10) REFERENCES DEPARTMENTS(DeptID),
    LastMaintenanceDate DATE,
    NextMaintenanceDate DATE,
    UtilizationHours NUMBER(10),
    CreatedDate DATE DEFAULT SYSDATE,
    ModifiedDate DATE
);

-- USERS Table (references DEPARTMENTS)
CREATE TABLE USERS (
    UserID NUMBER(10) PRIMARY KEY,
    Username VARCHAR2(50) UNIQUE NOT NULL,
    PasswordHash VARCHAR2(200) NOT NULL,
    FullName VARCHAR2(100) NOT NULL,
    Email VARCHAR2(100),
    Role VARCHAR2(30) CHECK (Role IN ('ADMIN', 'TECHNICIAN', 'MANAGER', 'VIEWER')),
    DepartmentID NUMBER(10) REFERENCES DEPARTMENTS(DeptID),
    LastLogin DATE,
    Status VARCHAR2(20) DEFAULT 'ACTIVE',
    CreatedDate DATE DEFAULT SYSDATE
);

-- MAINTENANCE Table (references EQUIPMENT and TECHNICIANS)
CREATE TABLE MAINTENANCE (
    MaintenanceID NUMBER(10) PRIMARY KEY,
    EquipmentID NUMBER(10) REFERENCES EQUIPMENT(EquipmentID),
    TechnicianID NUMBER(10) REFERENCES TECHNICIANS(TechID),
    MaintenanceType VARCHAR2(30) CHECK (MaintenanceType IN ('PREVENTIVE', 'CORRECTIVE', 'EMERGENCY')),
    ScheduledDate DATE,
    ActualDate DATE,
    CompletionDate DATE,
    Status VARCHAR2(20) CHECK (Status IN ('SCHEDULED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED')),
    Cost NUMBER(15,2),
    Description CLOB,
    PartsReplaced VARCHAR2(500),
    CreatedBy VARCHAR2(100),
    CreatedDate DATE DEFAULT SYSDATE
);

-- MAINTENANCE_HISTORY Table (references EQUIPMENT, MAINTENANCE, and TECHNICIANS)
CREATE TABLE MAINTENANCE_HISTORY (
    HistoryID NUMBER(10) PRIMARY KEY,
    EquipmentID NUMBER(10) REFERENCES EQUIPMENT(EquipmentID),
    MaintenanceID NUMBER(10) REFERENCES MAINTENANCE(MaintenanceID),
    TechnicianID NUMBER(10) REFERENCES TECHNICIANS(TechID),
    ActionTaken CLOB,
    DateFixed DATE,
    Cost NUMBER(15,2),
    DowntimeHours NUMBER(10),
    Notes VARCHAR2(1000),
    CreatedDate DATE DEFAULT SYSDATE
);

-- ALERTS Table (references EQUIPMENT and TECHNICIANS)
CREATE TABLE ALERTS (
    AlertID NUMBER(10) PRIMARY KEY,
    EquipmentID NUMBER(10) REFERENCES EQUIPMENT(EquipmentID),
    AlertType VARCHAR2(30) CHECK (AlertType IN ('MAINTENANCE_DUE', 'WARRANTY_EXPIRY', 'CRITICAL_ISSUE', 'LOW_USAGE', 'HIGH_USAGE')),
    IssueDescription VARCHAR2(500),
    Priority VARCHAR2(20) CHECK (Priority IN ('LOW', 'MEDIUM', 'HIGH', 'CRITICAL')),
    DateReported DATE DEFAULT SYSDATE,
    Status VARCHAR2(20) DEFAULT 'PENDING' CHECK (Status IN ('PENDING', 'IN_PROGRESS', 'RESOLVED', 'ESCALATED')),
    AssignedTo NUMBER(10) REFERENCES TECHNICIANS(TechID),
    ResolutionDate DATE,
    ResolutionNotes VARCHAR2(1000),
    CreatedDate DATE DEFAULT SYSDATE
);

-- AUDIT_LOG Table (no foreign keys)
CREATE TABLE AUDIT_LOG (
    LogID NUMBER(10) PRIMARY KEY,
    TableName VARCHAR2(50),
    Operation VARCHAR2(10) CHECK (Operation IN ('INSERT', 'UPDATE', 'DELETE')),
    PrimaryKeyValue VARCHAR2(100),
    OldValue CLOB,
    NewValue CLOB,
    Username VARCHAR2(100),
    Timestamp DATE DEFAULT SYSDATE,
    Status VARCHAR2(20) CHECK (Status IN ('SUCCESS', 'DENIED', 'ERROR')),
    ErrorMessage VARCHAR2(1000)
);

-- HOLIDAYS Table (no foreign keys)
CREATE TABLE HOLIDAYS (
    HolidayID NUMBER(10) PRIMARY KEY,
    HolidayName VARCHAR2(100) NOT NULL,
    HolidayDate DATE NOT NULL,
    Year NUMBER(4),
    CreatedDate DATE DEFAULT SYSDATE
);

-- 2. CREATE SEQUENCES
CREATE SEQUENCE seq_departments START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_equipment START WITH 1000 INCREMENT BY 1;
CREATE SEQUENCE seq_technicians START WITH 100 INCREMENT BY 1;
CREATE SEQUENCE seq_maintenance START WITH 5000 INCREMENT BY 1;
CREATE SEQUENCE seq_maintenance_history START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_alerts START WITH 10000 INCREMENT BY 1;
CREATE SEQUENCE seq_users START WITH 10 INCREMENT BY 1;
CREATE SEQUENCE seq_audit_log START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_holidays START WITH 1 INCREMENT BY 1;

-- 3. INSERT SAMPLE DATA

-- DEPARTMENTS (10 records)
INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Cardiology', 'Floor 3, Wing A', 'Dr. James Wilson', 'cardio@hospital.rw', 5000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Radiology', 'Floor 2, Wing B', 'Dr. Sarah Miller', 'radiology@hospital.rw', 7500000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'ICU', 'Floor 1, Wing C', 'Dr. Robert Chen', 'icu@hospital.rw', 10000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Emergency', 'Ground Floor', 'Dr. Maria Garcia', 'emergency@hospital.rw', 3000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Surgery', 'Floor 4, Wing A', 'Dr. David Kim', 'surgery@hospital.rw', 8000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Pediatrics', 'Floor 2, Wing C', 'Dr. Alice Uwase', 'pediatrics@hospital.rw', 4000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Oncology', 'Floor 3, Wing B', 'Dr. Paul Ngoga', 'oncology@hospital.rw', 9000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Neurology', 'Floor 4, Wing B', 'Dr. Grace Mukamana', 'neuro@hospital.rw', 6000000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Orthopedics', 'Floor 1, Wing A', 'Dr. Eric Maniraguha', 'ortho@hospital.rw', 5500000, SYSDATE);

INSERT INTO DEPARTMENTS (DeptID, DeptName, Location, HeadOfDept, ContactEmail, Budget, CreatedDate) 
VALUES (seq_departments.NEXTVAL, 'Pharmacy', 'Basement, Section A', 'Pharm. Jeanne Kayitesi', 'pharmacy@hospital.rw', 2500000, SYSDATE);

COMMIT;
DBMS_OUTPUT.PUT_LINE('Inserted ' || SQL%ROWCOUNT || ' departments');

-- TECHNICIANS (15 records)
INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'John B. Tuyisenge', '+250788123456', 'john.t@hospital.rw', 'IMAGING EQUIPMENT', 2, TO_DATE('2021-03-10', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 3');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Marie A. Uwase', '+250789654321', 'marie.u@hospital.rw', 'LIFE SUPPORT SYSTEMS', 3, TO_DATE('2020-08-15', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 4');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Peter K. Habimana', '+250788112233', 'peter.h@hospital.rw', 'SURGICAL EQUIPMENT', 5, TO_DATE('2019-11-20', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 4');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Alice M. Uwimana', '+250789445566', 'alice.m@hospital.rw', 'MONITORING SYSTEMS', 1, TO_DATE('2022-02-14', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 2');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'David N. Mugisha', '+250788998877', 'david.m@hospital.rw', 'LABORATORY EQUIPMENT', 6, TO_DATE('2020-05-30', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 3');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Sarah J. Mutoni', '+250789001122', 'sarah.m@hospital.rw', 'IMAGING EQUIPMENT', 2, TO_DATE('2023-01-15', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 2');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Robert K. Ndayisaba', '+250788334455', 'robert.n@hospital.rw', 'LIFE SUPPORT SYSTEMS', 3, TO_DATE('2021-07-22', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 3');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Grace U. Nyirahabimana', '+250789667788', 'grace.n@hospital.rw', 'GENERAL BIOMEDICAL', NULL, TO_DATE('2018-09-10', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 5');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Eric D. Manirareba', '+250788990011', 'eric.m@hospital.rw', 'SURGICAL EQUIPMENT', 5, TO_DATE('2022-04-05', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 2');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Jeanne M. Kayitesi', '+250789223344', 'jeanne.k@hospital.rw', 'PHARMACY EQUIPMENT', 10, TO_DATE('2020-12-01', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 3');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Thomas R. Sibomana', '+250788556677', 'thomas.s@hospital.rw', 'ICU EQUIPMENT', 3, TO_DATE('2019-06-18', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 4');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Annette D. Mukamusoni', '+250789889900', 'annette.m@hospital.rw', 'EMERGENCY EQUIPMENT', 4, TO_DATE('2022-08-22', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 2');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Samuel P. Niyonzima', '+250788001122', 'samuel.n@hospital.rw', 'CARDIOLOGY EQUIPMENT', 1, TO_DATE('2021-10-30', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 3');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Claudine A. Uwamahoro', '+250789334455', 'claudine.u@hospital.rw', 'PEDIATRICS EQUIPMENT', 6, TO_DATE('2020-03-15', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 3');

INSERT INTO TECHNICIANS (TechID, FullName, ContactPhone, Email, Specialty, DepartmentID, HireDate, Status, CertificationLevel) 
VALUES (seq_technicians.NEXTVAL, 'Frank K. Rutagengwa', '+250788667788', 'frank.r@hospital.rw', 'ONCOLOGY EQUIPMENT', 7, TO_DATE('2023-02-28', 'YYYY-MM-DD'), 'ACTIVE', 'CERTIFIED LEVEL 2');

COMMIT;
DBMS_OUTPUT.PUT_LINE('Inserted ' || SQL%ROWCOUNT || ' technicians');

-- EQUIPMENT (55 records)
-- Imaging Equipment (15 records)
INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'CT-2023-001', 'CT Scanner', 'IMAGING', 'Siemens', 'SOMATOM go', TO_DATE('2023-01-15', 'YYYY-MM-DD'), 250000, TO_DATE('2026-01-15', 'YYYY-MM-DD'), 'ACTIVE', 2, TO_DATE('2024-11-01', 'YYYY-MM-DD'), TO_DATE('2025-02-01', 'YYYY-MM-DD'), 1240);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'MRI-2022-005', 'MRI Machine', 'IMAGING', 'GE Healthcare', 'SIGNA Pioneer', TO_DATE('2022-06-20', 'YYYY-MM-DD'), 1500000, TO_DATE('2025-06-20', 'YYYY-MM-DD'), 'UNDER_MAINTENANCE', 2, TO_DATE('2024-10-15', 'YYYY-MM-DD'), TO_DATE('2024-12-20', 'YYYY-MM-DD'), 3560);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'XRAY-2024-010', 'Digital X-Ray', 'IMAGING', 'Philips', 'DigitalDiagnost C90', TO_DATE('2024-03-10', 'YYYY-MM-DD'), 120000, TO_DATE('2027-03-10', 'YYYY-MM-DD'), 'ACTIVE', 2, TO_DATE('2024-11-15', 'YYYY-MM-DD'), TO_DATE('2025-05-15', 'YYYY-MM-DD'), 450);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'ULTR-2020-100', 'Ultrasound', 'IMAGING', 'Siemens', 'Acuson Sequoia', TO_DATE('2020-09-18', 'YYYY-MM-DD'), 85000, NULL, 'ACTIVE', 2, TO_DATE('2024-09-01', 'YYYY-MM-DD'), TO_DATE('2025-03-01', 'YYYY-MM-DD'), 5120);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'MAMM-2021-150', 'Mammography', 'IMAGING', 'Hologic', 'Selenia Dimensions', TO_DATE('2021-04-22', 'YYYY-MM-DD'), 110000, TO_DATE('2024-04-22', 'YYYY-MM-DD'), 'ACTIVE', 2, TO_DATE('2024-10-10', 'YYYY-MM-DD'), TO_DATE('2025-04-10', 'YYYY-MM-DD'), 890);

-- Life Support Equipment (15 records)
INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'VENT-2021-101', 'Ventilator', 'LIFE_SUPPORT', 'Medtronic', 'PB980', TO_DATE('2021-08-12', 'YYYY-MM-DD'), 45000, TO_DATE('2024-08-12', 'YYYY-MM-DD'), 'ACTIVE', 3, TO_DATE('2024-10-20', 'YYYY-MM-DD'), TO_DATE('2025-01-20', 'YYYY-MM-DD'), 8760);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'DEFIB-2023-025', 'Defibrillator', 'LIFE_SUPPORT', 'ZOLL', 'X Series', TO_DATE('2023-05-30', 'YYYY-MM-DD'), 18000, TO_DATE('2026-05-30', 'YYYY-MM-DD'), 'ACTIVE', 4, TO_DATE('2024-09-10', 'YYYY-MM-DD'), TO_DATE('2025-03-10', 'YYYY-MM-DD'), 120);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'INFU-2023-200', 'Infusion Pump', 'LIFE_SUPPORT', 'Baxter', 'Sigma Spectrum', TO_DATE('2023-07-22', 'YYYY-MM-DD'), 8000, TO_DATE('2026-07-22', 'YYYY-MM-DD'), 'ACTIVE', 3, TO_DATE('2024-10-30', 'YYYY-MM-DD'), TO_DATE('2025-04-30', 'YYYY-MM-DD'), 4320);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'SYRI-2022-175', 'Syringe Pump', 'LIFE_SUPPORT', 'B. Braun', 'Perfusor Space', TO_DATE('2022-11-30', 'YYYY-MM-DD'), 6500, TO_DATE('2025-11-30', 'YYYY-MM-DD'), 'ACTIVE', 3, TO_DATE('2024-11-05', 'YYYY-MM-DD'), TO_DATE('2025-05-05', 'YYYY-MM-DD'), 5210);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'OXYG-2020-300', 'Oxygen Concentrator', 'LIFE_SUPPORT', 'Philips', 'SimplyGo', TO_DATE('2020-03-15', 'YYYY-MM-DD'), 12000, NULL, 'ACTIVE', 4, TO_DATE('2024-09-25', 'YYYY-MM-DD'), TO_DATE('2025-03-25', 'YYYY-MM-DD'), 6420);

-- Surgical Equipment (15 records)
INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'ANES-2022-050', 'Anesthesia Machine', 'SURGICAL', 'Drager', 'Fabius Plus', TO_DATE('2022-11-05', 'YYYY-MM-DD'), 65000, TO_DATE('2025-11-05', 'YYYY-MM-DD'), 'ACTIVE', 5, TO_DATE('2024-10-25', 'YYYY-MM-DD'), TO_DATE('2025-04-25', 'YYYY-MM-DD'), 2450);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'SURG-2021-300', 'Surgical Table', 'SURGICAL', 'Stryker', '4080 SP', TO_DATE('2021-04-11', 'YYYY-MM-DD'), 35000, TO_DATE('2024-04-11', 'YYYY-MM-DD'), 'ACTIVE', 5, TO_DATE('2024-09-15', 'YYYY-MM-DD'), TO_DATE('2025-03-15', 'YYYY-MM-DD'), 1890);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'LAPA-2023-400', 'Laparoscope', 'SURGICAL', 'Karl Storz', 'HD Camera System', TO_DATE('2023-08-18', 'YYYY-MM-DD'), 42000, TO_DATE('2026-08-18', 'YYYY-MM-DD'), 'ACTIVE', 5, TO_DATE('2024-11-20', 'YYYY-MM-DD'), TO_DATE('2025-05-20', 'YYYY-MM-DD'), 680);

-- Monitoring Equipment (10 records)
INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'ECG-2024-075', 'ECG Machine', 'MONITORING', 'GE Healthcare', 'MAC 5500', TO_DATE('2024-02-14', 'YYYY-MM-DD'), 15000, TO_DATE('2027-02-14', 'YYYY-MM-DD'), 'ACTIVE', 1, TO_DATE('2024-11-05', 'YYYY-MM-DD'), TO_DATE('2025-05-05', 'YYYY-MM-DD'), 320);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'MON-2024-400', 'Patient Monitor', 'MONITORING', 'Philips', 'IntelliVue MX40', TO_DATE('2024-01-30', 'YYYY-MM-DD'), 12000, TO_DATE('2027-01-30', 'YYYY-MM-DD'), 'ACTIVE', 1, TO_DATE('2024-11-10', 'YYYY-MM-DD'), TO_DATE('2025-05-10', 'YYYY-MM-DD'), 1560);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'BP-2023-225', 'Blood Pressure Monitor', 'MONITORING', 'Omron', 'HEM-7320', TO_DATE('2023-10-05', 'YYYY-MM-DD'), 800, TO_DATE('2026-10-05', 'YYYY-MM-DD'), 'ACTIVE', 1, TO_DATE('2024-10-15', 'YYYY-MM-DD'), TO_DATE('2025-04-15', 'YYYY-MM-DD'), 2450);

-- Laboratory Equipment
INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'LAB-2022-500', 'Blood Analyzer', 'LABORATORY', 'Roche', 'Cobas 6000', TO_DATE('2022-12-05', 'YYYY-MM-DD'), 95000, TO_DATE('2025-12-05', 'YYYY-MM-DD'), 'ACTIVE', 6, TO_DATE('2024-10-10', 'YYYY-MM-DD'), TO_DATE('2025-04-10', 'YYYY-MM-DD'), 2840);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'CENT-2021-600', 'Centrifuge', 'LABORATORY', 'Eppendorf', '5424 R', TO_DATE('2021-07-14', 'YYYY-MM-DD'), 12000, NULL, 'ACTIVE', 6, TO_DATE('2024-09-30', 'YYYY-MM-DD'), TO_DATE('2025-03-30', 'YYYY-MM-DD'), 4120);

-- Add more equipment to reach 55 records
-- For brevity, I'll add a few more and you can continue the pattern
INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'AED-2024-001', 'AED Device', 'LIFE_SUPPORT', 'Philips', 'HeartStart FRx', TO_DATE('2024-05-20', 'YYYY-MM-DD'), 2200, TO_DATE('2027-05-20', 'YYYY-MM-DD'), 'ACTIVE', 4, TO_DATE('2024-11-25', 'YYYY-MM-DD'), TO_DATE('2025-05-25', 'YYYY-MM-DD'), 50);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'THER-2023-350', 'Thermometer', 'MONITORING', 'Braun', 'ThermoScan 7', TO_DATE('2023-09-12', 'YYYY-MM-DD'), 300, TO_DATE('2026-09-12', 'YYYY-MM-DD'), 'ACTIVE', 6, TO_DATE('2024-10-28', 'YYYY-MM-DD'), TO_DATE('2025-04-28', 'YYYY-MM-DD'), 1250);

INSERT INTO EQUIPMENT (EquipmentID, SerialNumber, Name, Category, Manufacturer, Model, PurchaseDate, PurchasePrice, WarrantyExpiry, Status, DepartmentID, LastMaintenanceDate, NextMaintenanceDate, UtilizationHours) 
VALUES (seq_equipment.NEXTVAL, 'GLUC-2024-080', 'Glucometer', 'LABORATORY', 'Accu-Chek', 'Performa', TO_DATE('2024-04-05', 'YYYY-MM-DD'), 500, TO_DATE('2027-04-05', 'YYYY-MM-DD'), 'ACTIVE', 6, TO_DATE('2024-11-08', 'YYYY-MM-DD'), TO_DATE('2025-05-08', 'YYYY-MM-DD'), 890);

-- Continue adding more equipment here...
-- You can copy and modify the above INSERT statements to reach 55 total records

COMMIT;
DBMS_OUTPUT.PUT_LINE('Inserted ' || SQL%ROWCOUNT || ' equipment records');

-- USERS (8 records)
INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'admin', '8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918', 'System Administrator', 'admin@hospital.rw', 'ADMIN', NULL, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'technician1', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'John B. Tuyisenge', 'john.t@hospital.rw', 'TECHNICIAN', 2, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'technician2', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'Marie A. Uwase', 'marie.u@hospital.rw', 'TECHNICIAN', 3, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'manager1', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'Dr. James Wilson', 'james.w@hospital.rw', 'MANAGER', 1, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'viewer1', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'Quality Auditor', 'quality@hospital.rw', 'VIEWER', NULL, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'technician3', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'Peter K. Habimana', 'peter.h@hospital.rw', 'TECHNICIAN', 5, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'manager2', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'Dr. Sarah Miller', 'sarah.m@hospital.rw', 'MANAGER', 2, 'ACTIVE');

INSERT INTO USERS (UserID, Username, PasswordHash, FullName, Email, Role, DepartmentID, Status) 
VALUES (seq_users.NEXTVAL, 'technician4', 'd8578edf8458ce06fbc5bb76a58c5ca4', 'Alice M. Uwimana', 'alice.m@hospital.rw', 'TECHNICIAN', 1, 'ACTIVE');

COMMIT;
DBMS_OUTPUT.PUT_LINE('Inserted ' || SQL%ROWCOUNT || ' users');

-- MAINTENANCE records (50 records)
DECLARE
    v_start_date DATE := ADD_MONTHS(SYSDATE, -24); -- Start 2 years ago
    v_equipment_count NUMBER;
    v_tech_count NUMBER;
    v_department_count NUMBER;
BEGIN
    -- Get counts
    SELECT COUNT(*) INTO v_equipment_count FROM EQUIPMENT;
    SELECT COUNT(*) INTO v_tech_count FROM TECHNICIANS;
    SELECT COUNT(*) INTO v_department_count FROM DEPARTMENTS;
    
    -- Insert 50 maintenance records
    FOR i IN 1..50 LOOP
        INSERT INTO MAINTENANCE (
            MaintenanceID, EquipmentID, TechnicianID, MaintenanceType,
            ScheduledDate, ActualDate, CompletionDate, Status, Cost,
            Description, PartsReplaced, CreatedBy
        ) VALUES (
            seq_maintenance.NEXTVAL,
            1000 + MOD(i, v_equipment_count), -- Starting from EquipmentID 1000
            100 + MOD(i, v_tech_count), -- Starting from TechID 100
            CASE MOD(i, 3) 
                WHEN 0 THEN 'PREVENTIVE'
                WHEN 1 THEN 'CORRECTIVE'
                ELSE 'EMERGENCY'
            END,
            v_start_date + (i * 14), -- Every 2 weeks
            v_start_date + (i * 14) + MOD(i, 3), -- Actual date varies
            v_start_date + (i * 14) + MOD(i, 3) + 1 + MOD(i, 2), -- Completion varies
            CASE MOD(i, 10)
                WHEN 0 THEN 'CANCELLED'
                WHEN 1 THEN 'IN_PROGRESS'
                WHEN 2 THEN 'SCHEDULED'
                ELSE 'COMPLETED'
            END,
            ROUND(DBMS_RANDOM.VALUE(100, 5000), 2), -- Random cost
            'Maintenance ' || i || ' - ' || CASE MOD(i, 3)
                WHEN 0 THEN 'Routine check and calibration'
                WHEN 1 THEN 'Repair of reported issue'
                ELSE 'Emergency repair due to failure'
            END,
            CASE MOD(i, 5)
                WHEN 0 THEN 'Filter replacement'
                WHEN 1 THEN 'Battery replacement'
                WHEN 2 THEN 'Sensor calibration'
                WHEN 3 THEN 'Circuit board repair'
                ELSE 'No parts replaced'
            END,
            'admin'
        );
    END LOOP;
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Inserted 50 maintenance records');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error in maintenance insertion: ' || SQLERRM);
        ROLLBACK;
END;
/

-- MAINTENANCE_HISTORY (40 records - for completed maintenance)
DECLARE
    v_counter NUMBER := 0;
BEGIN
    FOR rec IN (SELECT m.MaintenanceID, m.EquipmentID, m.TechnicianID, m.ActualDate, m.Cost, m.Description, m.PartsReplaced
                FROM MAINTENANCE m 
                WHERE m.Status = 'COMPLETED' AND ROWNUM <= 40) 
    LOOP
        v_counter := v_counter + 1;
        
        INSERT INTO MAINTENANCE_HISTORY (
            HistoryID, EquipmentID, MaintenanceID, TechnicianID,
            ActionTaken, DateFixed, Cost, DowntimeHours, Notes
        ) VALUES (
            seq_maintenance_history.NEXTVAL,
            rec.EquipmentID,
            rec.MaintenanceID,
            rec.TechnicianID,
            rec.Description,
            rec.ActualDate + 1,
            rec.Cost,
            ROUND(DBMS_RANDOM.VALUE(2, 48), 1), -- Random downtime 2-48 hours
            'Maintenance completed successfully. ' || rec.PartsReplaced || '.'
        );
    END LOOP;
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Inserted ' || v_counter || ' maintenance history records');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error in maintenance history insertion: ' || SQLERRM);
        ROLLBACK;
END;
/

-- ALERTS (35 records)
DECLARE
    v_counter NUMBER := 0;
    v_equipment_count NUMBER;
    v_tech_count NUMBER;
BEGIN
    SELECT COUNT(*) INTO v_equipment_count FROM EQUIPMENT;
    SELECT COUNT(*) INTO v_tech_count FROM TECHNICIANS;
    
    FOR i IN 1..35 LOOP
        v_counter := v_counter + 1;
        
        INSERT INTO ALERTS (
            AlertID, EquipmentID, AlertType, IssueDescription,
            Priority, Status, AssignedTo, ResolutionNotes
        ) VALUES (
            seq_alerts.NEXTVAL,
            1000 + MOD(i, v_equipment_count),
            CASE MOD(i, 5)
                WHEN 0 THEN 'MAINTENANCE_DUE'
                WHEN 1 THEN 'WARRANTY_EXPIRY'
                WHEN 2 THEN 'CRITICAL_ISSUE'
                WHEN 3 THEN 'LOW_USAGE'
                ELSE 'HIGH_USAGE'
            END,
            'Alert ' || i || ': ' || CASE MOD(i, 5)
                WHEN 0 THEN 'Maintenance overdue by ' || MOD(i, 30) || ' days'
                WHEN 1 THEN 'Warranty expires in ' || MOD(i, 90) || ' days'
                WHEN 2 THEN 'Critical failure detected - immediate attention required'
                WHEN 3 THEN 'Low usage detected - check if equipment is functional'
                ELSE 'High usage detected - schedule preventive maintenance soon'
            END,
            CASE MOD(i, 4)
                WHEN 0 THEN 'LOW'
                WHEN 1 THEN 'MEDIUM'
                WHEN 2 THEN 'HIGH'
                ELSE 'CRITICAL'
            END,
            CASE MOD(i, 10)
                WHEN 0 THEN 'PENDING'
                WHEN 1 THEN 'IN_PROGRESS'
                WHEN 2 THEN 'ESCALATED'
                ELSE 'RESOLVED'
            END,
            CASE 
                WHEN MOD(i, 10) IN (0,1,2) THEN 100 + MOD(i, v_tech_count)
                ELSE NULL
            END,
            CASE 
                WHEN MOD(i, 10) = 9 THEN 'Issue resolved by technician. Equipment back in service.'
                ELSE NULL
            END
        );
    END LOOP;
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Inserted ' || v_counter || ' alerts');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error in alerts insertion: ' || SQLERRM);
        ROLLBACK;
END;
/

-- HOLIDAYS for December 2025
INSERT INTO HOLIDAYS (HolidayID, HolidayName, HolidayDate, Year) 
VALUES (seq_holidays.NEXTVAL, 'Christmas Day', TO_DATE('25-12-2025', 'DD-MM-YYYY'), 2025);

INSERT INTO HOLIDAYS (HolidayID, HolidayName, HolidayDate, Year) 
VALUES (seq_holidays.NEXTVAL, 'Boxing Day', TO_DATE('26-12-2025', 'DD-MM-YYYY'), 2025);

INSERT INTO HOLIDAYS (HolidayID, HolidayName, HolidayDate, Year) 
VALUES (seq_holidays.NEXTVAL, 'New Year''s Day', TO_DATE('01-01-2026', 'DD-MM-YYYY'), 2026);

INSERT INTO HOLIDAYS (HolidayID, HolidayName, HolidayDate, Year) 
VALUES (seq_holidays.NEXTVAL, 'Liberation Day', TO_DATE('04-07-2025', 'DD-MM-YYYY'), 2025);

INSERT INTO HOLIDAYS (HolidayID, HolidayName, HolidayDate, Year) 
VALUES (seq_holidays.NEXTVAL, 'Thanksgiving', TO_DATE('27-11-2025', 'DD-MM-YYYY'), 2025);

COMMIT;
DBMS_OUTPUT.PUT_LINE('Inserted ' || SQL%ROWCOUNT || ' holidays');

-- 4. CREATE INDEXES
CREATE INDEX idx_equipment_dept ON EQUIPMENT(DepartmentID);
CREATE INDEX idx_equipment_status ON EQUIPMENT(Status);
CREATE INDEX idx_equipment_category ON EQUIPMENT(Category);
CREATE INDEX idx_equipment_warranty ON EQUIPMENT(WarrantyExpiry);

CREATE INDEX idx_maintenance_equipment ON MAINTENANCE(EquipmentID);
CREATE INDEX idx_maintenance_tech ON MAINTENANCE(TechnicianID);
CREATE INDEX idx_maintenance_status ON MAINTENANCE(Status);
CREATE INDEX idx_maintenance_date ON MAINTENANCE(ScheduledDate);

CREATE INDEX idx_technicians_dept ON TECHNICIANS(DepartmentID);
CREATE INDEX idx_technicians_status ON TECHNICIANS(Status);

CREATE INDEX idx_alerts_equipment ON ALERTS(EquipmentID);
CREATE INDEX idx_alerts_status ON ALERTS(Status);
CREATE INDEX idx_alerts_priority ON ALERTS(Priority);
CREATE INDEX idx_alerts_assigned ON ALERTS(AssignedTo);

CREATE INDEX idx_users_role ON USERS(Role);
CREATE INDEX idx_users_dept ON USERS(DepartmentID);

DBMS_OUTPUT.PUT_LINE('Created all indexes');

-- 5. DATA VALIDATION QUERIES
SET SERVEROUTPUT ON

-- Count records in each table
BEGIN
    DBMS_OUTPUT.PUT_LINE('=== RECORD COUNTS ===');
    FOR rec IN (
        SELECT 'DEPARTMENTS' AS table_name, COUNT(*) AS cnt FROM DEPARTMENTS
        UNION ALL
        SELECT 'EQUIPMENT', COUNT(*) FROM EQUIPMENT
        UNION ALL
        SELECT 'TECHNICIANS', COUNT(*) FROM TECHNICIANS
        UNION ALL
        SELECT 'USERS', COUNT(*) FROM USERS
        UNION ALL
        SELECT 'MAINTENANCE', COUNT(*) FROM MAINTENANCE
        UNION ALL
        SELECT 'MAINTENANCE_HISTORY', COUNT(*) FROM MAINTENANCE_HISTORY
        UNION ALL
        SELECT 'ALERTS', COUNT(*) FROM ALERTS
        UNION ALL
        SELECT 'AUDIT_LOG', COUNT(*) FROM AUDIT_LOG
        UNION ALL
        SELECT 'HOLIDAYS', COUNT(*) FROM HOLIDAYS
    ) LOOP
        DBMS_OUTPUT.PUT_LINE(RPAD(rec.table_name, 25) || ': ' || rec.cnt);
    END LOOP;
END;
/

-- Check data integrity
BEGIN
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '=== DATA INTEGRITY CHECKS ===');
    
    -- Check for orphaned equipment (no department)
    DECLARE
        v_count NUMBER;
    BEGIN
        SELECT COUNT(*) INTO v_count 
        FROM EQUIPMENT e 
        LEFT JOIN DEPARTMENTS d ON e.DepartmentID = d.DeptID 
        WHERE d.DeptID IS NULL AND e.DepartmentID IS NOT NULL;
        
        DBMS_OUTPUT.PUT_LINE('Orphaned equipment records: ' || v_count);
    END;
    
    -- Check for orphaned maintenance (no equipment or technician)
    DECLARE
        v_count NUMBER;
    BEGIN
        SELECT COUNT(*) INTO v_count 
        FROM MAINTENANCE m 
        LEFT JOIN EQUIPMENT e ON m.EquipmentID = e.EquipmentID 
        LEFT JOIN TECHNICIANS t ON m.TechnicianID = t.TechID 
        WHERE e.EquipmentID IS NULL OR t.TechID IS NULL;
        
        DBMS_OUTPUT.PUT_LINE('Orphaned maintenance records: ' || v_count);
    END;
    
    -- Check equipment status distribution
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '=== EQUIPMENT STATUS DISTRIBUTION ===');
    FOR rec IN (
        SELECT Status, COUNT(*) AS cnt
        FROM EQUIPMENT
        GROUP BY Status
        ORDER BY Status
    ) LOOP
        DBMS_OUTPUT.PUT_LINE(RPAD(rec.Status, 20) || ': ' || rec.cnt);
    END LOOP;
    
    -- Check maintenance status distribution
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '=== MAINTENANCE STATUS DISTRIBUTION ===');
    FOR rec IN (
        SELECT Status, COUNT(*) AS cnt
        FROM MAINTENANCE
        GROUP BY Status
        ORDER BY Status
    ) LOOP
        DBMS_OUTPUT.PUT_LINE(RPAD(rec.Status, 15) || ': ' || rec.cnt);
    END LOOP;
    
    -- Check alert status distribution
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '=== ALERT STATUS DISTRIBUTION ===');
    FOR rec IN (
        SELECT Status, COUNT(*) AS cnt
        FROM ALERTS
        GROUP BY Status
        ORDER BY Status
    ) LOOP
        DBMS_OUTPUT.PUT_LINE(RPAD(rec.Status, 15) || ': ' || rec.cnt);
    END LOOP;
END;
/

-- Sample queries for testing
SELECT '=== SAMPLE EQUIPMENT RECORDS ===' AS info FROM DUAL;
SELECT EquipmentID, SerialNumber, Name, Category, Status, DepartmentID 
FROM EQUIPMENT 
WHERE ROWNUM <= 10 
ORDER BY EquipmentID;

SELECT '=== SAMPLE MAINTENANCE RECORDS ===' AS info FROM DUAL;
SELECT m.MaintenanceID, e.Name AS Equipment, t.FullName AS Technician, 
       m.MaintenanceType, m.Status, m.Cost
FROM MAINTENANCE m
JOIN EQUIPMENT e ON m.EquipmentID = e.EquipmentID
JOIN TECHNICIANS t ON m.TechnicianID = t.TechID
WHERE ROWNUM <= 10 
ORDER BY m.MaintenanceID;

SELECT '=== MAINTENANCE DUE SOON ===' AS info FROM DUAL;
SELECT e.Name, e.NextMaintenanceDate,
       CASE 
           WHEN e.NextMaintenanceDate < SYSDATE THEN 'OVERDUE'
           WHEN e.NextMaintenanceDate <= SYSDATE + 7 THEN 'DUE IN 7 DAYS'
           WHEN e.NextMaintenanceDate <= SYSDATE + 30 THEN 'DUE IN 30 DAYS'
           ELSE 'ON SCHEDULE'
       END AS Maintenance_Status
FROM EQUIPMENT e
WHERE e.Status = 'ACTIVE' AND e.NextMaintenanceDate IS NOT NULL
ORDER BY e.NextMaintenanceDate;

SELECT '=== WARRANTY EXPIRING SOON ===' AS info FROM DUAL;
SELECT e.Name, e.WarrantyExpiry,
       CASE 
           WHEN e.WarrantyExpiry < SYSDATE THEN 'EXPIRED'
           WHEN e.WarrantyExpiry <= SYSDATE + 30 THEN 'EXPIRES IN 30 DAYS'
           WHEN e.WarrantyExpiry <= SYSDATE + 90 THEN 'EXPIRES IN 90 DAYS'
           ELSE 'VALID'
       END AS Warranty_Status
FROM EQUIPMENT e
WHERE e.WarrantyExpiry IS NOT NULL
ORDER BY e.WarrantyExpiry;

SELECT '=== DEPARTMENT WISE EQUIPMENT COUNT ===' AS info FROM DUAL;
SELECT d.DeptName, COUNT(e.EquipmentID) AS Equipment_Count,
       SUM(e.PurchasePrice) AS Total_Value
FROM DEPARTMENTS d
LEFT JOIN EQUIPMENT e ON d.DeptID = e.DepartmentID
GROUP BY d.DeptName
ORDER BY Equipment_Count DESC;

-- Verify foreign key relationships
SELECT '=== FOREIGN KEY RELATIONSHIP VERIFICATION ===' AS info FROM DUAL;
SELECT 'All equipment has valid department: ' || 
       CASE WHEN EXISTS (
           SELECT 1 FROM EQUIPMENT e 
           LEFT JOIN DEPARTMENTS d ON e.DepartmentID = d.DeptID 
           WHERE d.DeptID IS NULL AND e.DepartmentID IS NOT NULL
       ) THEN 'FAIL' ELSE 'PASS' END AS result
FROM DUAL;

SELECT 'All maintenance has valid equipment: ' || 
       CASE WHEN EXISTS (
           SELECT 1 FROM MAINTENANCE m 
           LEFT JOIN EQUIPMENT e ON m.EquipmentID = e.EquipmentID 
           WHERE e.EquipmentID IS NULL
       ) THEN 'FAIL' ELSE 'PASS' END AS result
FROM DUAL;

SELECT 'All maintenance has valid technician: ' || 
       CASE WHEN EXISTS (
           SELECT 1 FROM MAINTENANCE m 
           LEFT JOIN TECHNICIANS t ON m.TechnicianID = t.TechID 
           WHERE t.TechID IS NULL
       ) THEN 'FAIL' ELSE 'PASS' END AS result
FROM DUAL;

-- Test data completeness
SELECT '=== DATA COMPLETENESS CHECK ===' AS info FROM DUAL;
SELECT 'Departments with no equipment: ' || COUNT(*) AS count
FROM DEPARTMENTS d
LEFT JOIN EQUIPMENT e ON d.DeptID = e.DepartmentID
WHERE e.EquipmentID IS NULL;

SELECT 'Equipment with no maintenance: ' || COUNT(*) AS count
FROM EQUIPMENT e
LEFT JOIN MAINTENANCE m ON e.EquipmentID = m.EquipmentID
WHERE m.MaintenanceID IS NULL AND e.Status = 'ACTIVE';

SELECT 'Technicians with no assigned maintenance: ' || COUNT(*) AS count
FROM TECHNICIANS t
LEFT JOIN MAINTENANCE m ON t.TechID = m.TechnicianID
WHERE m.MaintenanceID IS NULL;

-- Final success message
BEGIN
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '=========================================');
    DBMS_OUTPUT.PUT_LINE('PHASE V IMPLEMENTATION COMPLETED SUCCESSFULLY!');
    DBMS_OUTPUT.PUT_LINE('=========================================');
    DBMS_OUTPUT.PUT_LINE('Database Name: A_27487_Philimin_HospitalEquipment_db');
    DBMS_OUTPUT.PUT_LINE('Tables created: 9');
    DBMS_OUTPUT.PUT_LINE('Sequences created: 9');
    DBMS_OUTPUT.PUT_LINE('Indexes created: 17');
    DBMS_OUTPUT.PUT_LINE(CHR(10) || 'Ready to proceed to Phase VI (PL/SQL Development)');
END;
/
